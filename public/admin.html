<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Facettes Content Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .section-card { transition: all 0.3s ease; }
    .section-card:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    .success-message { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { transform: translateY(-100px); opacity:0 } to { transform: translateY(0); opacity:1 } }
    @keyframes spin { 0% { transform: rotate(0deg) } 100% { transform: rotate(360deg) } }
    .animate-spin { animation: spin 1s linear infinite; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <!-- Success Message -->
  <div id="successMessage" class="hidden fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 success-message">
    <div class="flex items-center space-x-2">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
      <span class="font-semibold">Changes saved successfully!</span>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-purple-800 text-white rounded-lg shadow-lg p-8 mb-8">
      <h1 class="text-4xl font-black mb-2">Facettes Content Manager</h1>
      <p class="text-purple-200">Edit your speaker bureau website content in English and French</p>
    </div>

    <!-- Language Tabs -->
    <div class="flex space-x-4 mb-6">
      <button onclick="switchLanguage('en')" id="tab-en" class="px-6 py-3 rounded-lg font-bold transition bg-purple-600 text-white shadow-lg">English 🇬🇧</button>
      <button onclick="switchLanguage('fr')" id="tab-fr" class="px-6 py-3 rounded-lg font-bold transition bg-gray-300 text-gray-700 hover:bg-gray-400">Français 🇫🇷</button>
    </div>

    <!-- Navigation Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">🧭 Navigation</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Site Name</label>
          <input type="text" data-field="siteName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Speakers Link</label>
          <input type="text" data-field="navSpeakers" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">About Link</label>
          <input type="text" data-field="navAbout" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Contact Link</label>
          <input type="text" data-field="navContact" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- Hero Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">🚀 Hero Section</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Main Title</label>
          <textarea data-field="heroTitle" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Subtitle</label>
          <textarea data-field="heroSubtitle" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
        </div>
      </div>
    </div>

    <!-- Search & Filters -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">🔍 Search & Filters</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Search Placeholder</label>
          <input type="text" data-field="searchPlaceholder" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">"All" Filter Button</label>
          <input type="text" data-field="filterAll" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Loading Message</label>
          <input type="text" data-field="loading" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Load More Button</label>
          <input type="text" data-field="loadMore" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- No Results Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">❌ No Results Messages</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">No Results Title</label>
          <input type="text" data-field="noResultsTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">No Results Text</label>
          <input type="text" data-field="noResultsText" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- Speaker Modal Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">👤 Speaker Modal</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Key Topics Title</label>
          <input type="text" data-field="keyTopicsTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Book Button Text</label>
          <input type="text" data-field="bookButton" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Book Message Alert</label>
          <input type="text" data-field="bookMessage" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- Services Section (kept same structure) -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">💼 Services Section</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Section Heading</label>
          <input type="text" data-field="services_heading" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Section Subtext</label>
          <input type="text" data-field="services_subtext" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>

        <!-- Service 1 -->
        <div class="bg-purple-50 border-l-4 border-purple-400 p-4 rounded mt-4">
          <h3 class="font-bold text-lg text-purple-800 mb-3">Service 1</h3>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
              <input type="text" data-field="service_1_title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
              <textarea data-field="service_1_description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
            </div>
          </div>
        </div>

        <!-- Service 2 -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
          <h3 class="font-bold text-lg text-blue-800 mb-3">Service 2</h3>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
              <input type="text" data-field="service_2_title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
              <textarea data-field="service_2_description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
            </div>
          </div>
        </div>

        <!-- Service 3 -->
        <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded">
          <h3 class="font-bold text-lg text-green-800 mb-3">Service 3</h3>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
              <input type="text" data-field="service_3_title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
              <textarea data-field="service_3_description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">📧 Contact Section</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Contact Heading</label>
          <input type="text" data-field="contact_heading" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Contact Tagline</label>
          <textarea data-field="contact_tagline" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Form: Name Field</label>
          <input type="text" data-field="form_name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Form: Email Field</label>
          <input type="text" data-field="form_email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Form: Event Field</label>
          <input type="text" data-field="form_event" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Form: Details Field</label>
          <input type="text" data-field="form_details" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Form: Submit Button</label>
          <input type="text" data-field="form_submit" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Response Time Message</label>
          <input type="text" data-field="contact_response_time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- CTA Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">📣 Call to Action Section</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">CTA Title</label>
          <input type="text" data-field="ctaTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">CTA Text</label>
          <textarea data-field="ctaText" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">CTA Button</label>
          <input type="text" data-field="ctaButton" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-purple-600 pb-2">📄 Footer</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Copyright Text</label>
          <input type="text" data-field="footerCopyright" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Contact Info</label>
          <input type="text" data-field="footerContact" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>
      </div>
    </div>

    <!-- Speakers Management Section -->
    <div class="section-card bg-white rounded-lg shadow-md p-6 mb-6">
      <div class="flex justify-between items-center mb-4 border-b-2 border-purple-600 pb-2">
        <h2 class="text-2xl font-bold text-gray-800">👥 Manage Speakers (<span id="speakerCount">0</span>)</h2>
        <div class="flex space-x-2">
          <button onclick="refreshSpeakersFromAPI()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
            <span>Sync from API</span>
          </button>
          <button onclick="addNewSpeaker()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            <span>Add New Speaker</span>
          </button>
        </div>
      </div>

      <div class="mb-4">
        <input type="text" id="speakerSearch" onkeyup="filterSpeakers()" placeholder="Search speakers by name..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
      </div>

      <div id="speakersList" class="space-y-4"></div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 sticky bottom-4">
      <button onclick="saveContent()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg shadow-xl transition transform hover:scale-105 flex items-center justify-center space-x-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
        <span>Save All Changes</span>
      </button>
      <button onclick="exportContent()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-lg shadow-xl transition transform hover:scale-105 flex items-center justify-center space-x-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        <span>Download Backup</span>
      </button>
      <a href="index.html" target="_blank" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg shadow-xl transition transform hover:scale-105 flex items-center justify-center space-x-2">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
        <span>Preview Site</span>
      </a>
    </div>

  </div>

  <!-- ================== SCRIPT ================== -->
  <script>
  // ======== State ========
  let contentData = { en: {}, fr: {} };
  let speakersData = [];
  let currentLang = 'en';

  // Default content fallback (used if API returns empty)
  const DEFAULT_CONTENT = {
    en: {
      siteName: "FACETTES",
      navSpeakers: "Speakers",
      navAbout: "About",
      navContact: "Contact",
      heroTitle: "Where Bold Ideas Meet Global Reach",
      heroSubtitle: "The agency for intersectional talent, shaping the future of culture, commerce, and impact.",
      searchPlaceholder: "Search speakers...",
      filterAll: "All",
      loading: "Loading speakers...",
      noResultsTitle: "No speakers found",
      noResultsText: "Try adjusting your search or filters",
      keyTopicsTitle: "Key Speaking Topics",
      bookButton: "Book This Speaker",
      bookMessage: "Contact form coming soon! Email: info@speakerbureau.com",
      services_heading: "Agency Expertise",
      services_subtext: "Beyond booking, we ensure seamless execution and maximum impact.",
      service_1_title: "Exclusive Speaker Access",
      service_1_description: "Direct access to a curated roster of global leaders. We manage negotiations and logistics from start to finish.",
      service_2_title: "Content Alignment & Strategy",
      service_2_description: "Strategic consultation to match speakers with your audience and event objectives for maximum message resonance, ensuring cultural fit.",
      service_3_title: "On-Site Logistics Support",
      service_3_description: "Comprehensive support including technical riders, travel coordination, on-site liaison management, and post-event feedback cycles.",
      contact_heading: "CONNECT",
      contact_tagline: "Initiate a conversation with our team to find the ideal voice for your next defining moment.",
      form_name: "Your Name",
      form_email: "Your Email",
      form_event: "Event Type / Topic Focus (e.g., Q3 Strategy Session on AI)",
      form_details: "Tell us about your audience, event date, and budget range...",
      form_submit: "SUBMIT INQUIRY",
      contact_response_time: "A consultant will be in touch within 24 hours.",
      footerCopyright: "© 2025 Speaker Bureau. All rights reserved.",
      footerContact: "Contact: info@speakerbureau.com | (555) 123-4567",
      loadMore: "Load More Speakers",
      ctaTitle: "Ready to Book a Speaker?",
      ctaText: "Let's discuss how our speakers can make your next event unforgettable. Get in touch with us today.",
      ctaButton: "Contact Us"
    },
    fr: {
      siteName: "FACETTES",
      navSpeakers: "Conférenciers",
      navAbout: "À propos",
      navContact: "Contact",
      heroTitle: "Là où les Idées Audacieuses Rencontrent la Portée Mondiale",
      heroSubtitle: "L'agence de talents intersectionnels, façonnant l'avenir de la culture, du commerce et de l'impact.",
      searchPlaceholder: "Rechercher des conférenciers...",
      filterAll: "Tous",
      loading: "Chargement des conférenciers...",
      loadMore: "Charger Plus de Conférenciers",
      noResultsTitle: "Aucun conférencier trouvé",
      noResultsText: "Essayez d'ajuster votre recherche ou vos filtres",
      keyTopicsTitle: "Sujets de Conférence Principaux",
      bookButton: "Réserver ce Conférencier",
      bookMessage: "Formulaire de contact bientôt disponible ! Email: info@speakerbureau.com",
      services_heading: "Services Événementiels Complets",
      services_subtext: "Au-delà de la réservation, nous assurons une exécution fluide et un impact maximal.",
      service_1_title: "Accès Exclusif aux Conférenciers",
      service_2_title: "Alignement et Stratégie de Contenu",
      service_3_title: "Soutien Logistique sur Place",
      contact_heading: "Prêt à Réserver un Conférencier ?",
      contact_tagline: "Parlez-nous de votre événement, de votre public et de vos objectifs, et l'équipe Facettes trouvera la voix parfaite.",
      form_name: "Votre Nom",
      form_email: "Votre Email",
      form_event: "Type d'Événement / Thème (ex : Session Stratégique T3 sur l'IA)",
      form_details: "Parlez-nous de votre public, de la date de l'événement et de la fourchette budgétaire...",
      form_submit: "SOUMETTRE LA DEMANDE",
      contact_response_time: "Un consultant vous contactera dans les 24 heures.",
      footerCopyright: "© 2025 Bureau de Conférenciers. Tous droits réservés.",
      footerContact: "Contact: info@speakerbureau.com | (555) 123-4567",
      ctaTitle: "Prêt à Réserver un Conférencier?",
      ctaText: "Discutons de la façon dont nos conférenciers peuvent rendre votre prochain événement inoubliable. Contactez-nous dès aujourd'hui.",
      ctaButton: "Nous Contacter"
    }
  };

  // ======== Utilities ========
  function showSuccess(msg = 'Changes saved successfully!') {
    const el = document.getElementById('successMessage');
    el.querySelector('span').textContent = msg;
    el.classList.remove('hidden');
    setTimeout(() => el.classList.add('hidden'), 2500);
  }

  function downloadObjectAsJson(exportObj, exportName){
    const dataStr = JSON.stringify(exportObj, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = exportName;
    link.click();
    URL.revokeObjectURL(url);
  }

  // ======== Load everything on startup (auto-sync) ========
  async function loadContent() {
    try {
      // parallel fetch content and speakers
      const [contentRes, speakersRes] = await Promise.all([
        fetch('/api/content'),
        fetch('/api/speakers')
      ]);

      if (contentRes.ok) {
        const c = await contentRes.json();
        // If server returned an empty object, fallback to defaults
        contentData = (Object.keys(c || {}).length === 0) ? DEFAULT_CONTENT : c;
      } else {
        contentData = DEFAULT_CONTENT;
      }

      if (speakersRes.ok) {
        speakersData = await speakersRes.json();
      } else {
        speakersData = [];
      }

      // populate UI
      populateFields();
      renderSpeakersList();
      console.log('✅ Loaded content + speakers from API');
    } catch (err) {
      console.error('Error loading content or speakers:', err);
      // fallback to defaults/local empty
      contentData = DEFAULT_CONTENT;
      speakersData = [];
      populateFields();
      renderSpeakersList();
    }
  }

  // ======== Content (site text) ========
  function saveCurrentLanguageData(){
    document.querySelectorAll('[data-field]').forEach(el => {
      const key = el.getAttribute('data-field');
      if (!currentLang) currentLang = 'en';
      contentData[currentLang] = contentData[currentLang] || {};
      contentData[currentLang][key] = el.value;
    });
  }

  function populateFields(){
    const data = (contentData && contentData[currentLang]) ? contentData[currentLang] : {};
    document.querySelectorAll('[data-field]').forEach(el => {
      const key = el.getAttribute('data-field');
      if (data[key] !== undefined && data[key] !== null) el.value = data[key];
      else el.value = '';
    });
  }

  async function saveContent(){
    saveCurrentLanguageData();
    try {
      const res = await fetch('/api/content', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(contentData)
      });
      if (!res.ok) throw new Error('Failed to save content');
      showSuccess('Content saved!');
    } catch (err) {
      alert('Error saving content: ' + err.message);
    }
  }

  // ======== Speakers CRUD ========
  function renderSpeakersList(){
    const container = document.getElementById('speakersList');
    const countElement = document.getElementById('speakerCount');
    countElement.textContent = speakersData.length;
    if (!speakersData.length) {
      container.innerHTML = '<p class="text-gray-500 text-center py-8">No speakers yet. Click "Add New Speaker" to create one.</p>';
      return;
    }
    container.innerHTML = speakersData.map((sp, i) => `
      <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition speaker-item" data-index="${i}">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <h3 class="text-lg font-bold text-gray-800">${sp.name || 'Unnamed Speaker'}</h3>
            <p class="text-sm text-gray-600">${sp.title || ''}</p>
            ${sp.name_fr ? `<p class="text-xs text-gray-500 mt-1">FR: ${sp.name_fr}</p>` : ''}
            <div class="mt-2 flex flex-wrap gap-2">
              ${(sp.topics || []).slice(0,3).map(t => `<span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">${t}</span>`).join('')}
              ${(sp.topics || []).length > 3 ? `<span class="text-xs text-gray-500">+${sp.topics.length - 3} more</span>` : ''}
            </div>
          </div>
          <div class="flex space-x-2">
            <button onclick="openEditModal(${i})" class="text-blue-600 hover:text-blue-800 p-2 rounded hover:bg-blue-50">Edit</button>
            <button onclick="deleteSpeaker(${i})" class="text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50">Delete</button>
          </div>
        </div>
      </div>
    `).join('');
  }

  // Create then open modal for editing
  async function addNewSpeaker(){
    const newSpeaker = {
      name: '', name_fr:'', title:'', title_fr:'', bio:'', bio_fr:'', topics:[], topics_fr:[], keyTopics:[], keyTopics_fr:[], image:''
    };
    try {
      const res = await fetch('/api/speakers', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newSpeaker)
      });
      if (!res.ok) throw new Error('Failed to create speaker');
      const created = await res.json();
      speakersData.push(created);
      renderSpeakersList();
      // open modal for newly created (last index)
      openEditModal(speakersData.length - 1);
    } catch (err) {
      alert('Error creating speaker: ' + err.message);
    }
  }

  // Delete
  async function deleteSpeaker(index){
    const s = speakersData[index];
    if (!s || !s.id) {
      // just remove locally
      speakersData.splice(index,1);
      renderSpeakersList();
      return;
    }
    if (!confirm(`Are you sure you want to delete "${s.name || 'this speaker'}"?`)) return;
    try {
      const res = await fetch(`/api/speakers/${s.id}`, { method: 'DELETE' });
      if (!res.ok) {
        const errText = await res.text().catch(()=>null);
        throw new Error(errText || 'Delete failed');
      }
      speakersData.splice(index,1);
      renderSpeakersList();
      showSuccess('Speaker deleted!');
    } catch (err) {
      alert('Error deleting speaker: ' + err.message);
    }
  }

  // Refresh from API (Sync)
  async function refreshSpeakersFromAPI(){
    if (!confirm('This will reload speakers from the API. Any unsaved changes will be lost. Continue?')) return;
    try {
      const res = await fetch('/api/speakers');
      if (!res.ok) throw new Error('Failed to fetch');
      speakersData = await res.json();
      renderSpeakersList();
      showSuccess('Speakers reloaded from server!');
    } catch (err) {
      alert('Error fetching speakers: ' + err.message);
    }
  }

  // ======== Edit Modal (full editor) ========
  function openEditModal(index){
    const speaker = speakersData[index] || {};
    const modalId = `speaker-modal-${Date.now()}`;
    const html = `
      <div id="${modalId}" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
          <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">Edit Speaker</h2>
            <button onclick="document.getElementById('${modalId}').remove()" class="text-gray-500 hover:text-gray-700">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
          </div>

          <div class="p-6 space-y-6">
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Name (English)</label>
                <input id="${modalId}-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml(speaker.name || '')}">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Nom (Français)</label>
                <input id="${modalId}-name-fr" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml(speaker.name_fr || '')}">
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Title (English)</label>
                <input id="${modalId}-title" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml(speaker.title || '')}">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Titre (Français)</label>
                <input id="${modalId}-title-fr" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml(speaker.title_fr || '')}">
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Bio (English)</label>
                <textarea id="${modalId}-bio" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${escapeHtml(speaker.bio || '')}</textarea>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Bio (Français)</label>
                <textarea id="${modalId}-bio-fr" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${escapeHtml(speaker.bio_fr || '')}</textarea>
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Topics (English, comma-separated)</label>
                <input id="${modalId}-topics" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml((speaker.topics||[]).join(', '))}" placeholder="Leadership, Innovation, Technology">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Sujets (Français, séparés par virgules)</label>
                <input id="${modalId}-topics-fr" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml((speaker.topics_fr||[]).join(', '))}" placeholder="Leadership, Innovation, Technologie">
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Key Topics (English, comma-separated)</label>
                <textarea id="${modalId}-key-topics" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${escapeHtml((speaker.keyTopics||[]).join(', '))}</textarea>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Sujets Clés (Français, séparés par virgules)</label>
                <textarea id="${modalId}-key-topics-fr" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${escapeHtml((speaker.keyTopics_fr||[]).join(', '))}</textarea>
              </div>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Image URL or Emoji</label>
              <div class="flex gap-2">
                <input id="${modalId}-image" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg" value="${escapeHtml(speaker.image || '')}" placeholder="/uploads/speaker.jpg or 👤">
                <input id="${modalId}-file" type="file" accept="image/*" class="px-3 py-2 border border-gray-200 rounded-lg" />
                <button id="${modalId}-upload-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Upload</button>
              </div>
              <p class="text-xs text-gray-500 mt-1">Upload image to server (max 5MB). After upload the image path will be stored as the speaker image.</p>
              <div id="${modalId}-preview" class="mt-3 ${!speaker.image ? 'hidden' : ''}">
                ${speaker.image ? `<img src="${escapeHtml(speaker.image)}" alt="preview" class="w-32 h-32 object-cover rounded">` : ''}
              </div>
            </div>

          </div>

          <div class="sticky bottom-0 bg-gray-50 border-t border-gray-200 p-6 flex justify-end space-x-3">
            <button onclick="document.getElementById('${modalId}').remove()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Cancel</button>
            <button id="${modalId}-save" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Save Speaker</button>
          </div>
        </div>
      </div>
    `;

    const wrapper = document.createElement('div');
    wrapper.innerHTML = html;
    document.body.appendChild(wrapper);

    // wire upload button
    const fileInput = document.getElementById(`${modalId}-file`);
    const uploadBtn = document.getElementById(`${modalId}-upload-btn`);
    const imageInput = document.getElementById(`${modalId}-image`);
    const previewDiv = document.getElementById(`${modalId}-preview`);

    uploadBtn.addEventListener('click', async () => {
      const file = fileInput.files[0];
      if (!file) { alert('Select a file first'); return; }
      if (!file.type.startsWith('image/')) { alert('Please select an image'); return; }
      if (file.size > 5 * 1024 * 1024) { alert('Image must be < 5MB'); return; }

      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Uploading...';
      try {
        const fd = new FormData();
        fd.append('image', file);
        const res = await fetch('/api/upload', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('Upload failed');
        const json = await res.json();
        const url = json.url || (json.path ? json.path : null);
        if (!url) throw new Error('No URL returned from upload');
        imageInput.value = url;
        // show preview
        previewDiv.innerHTML = `<img src="${url}" alt="preview" class="w-32 h-32 object-cover rounded">`;
        previewDiv.classList.remove('hidden');
      } catch (err) {
        alert('Upload error: ' + err.message);
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Upload';
      }
    });

    // wire save
    document.getElementById(`${modalId}-save`).addEventListener('click', async () => {
      // read fields
      const updated = {
        ...speaker,
        name: document.getElementById(`${modalId}-name`).value,
        name_fr: document.getElementById(`${modalId}-name-fr`).value,
        title: document.getElementById(`${modalId}-title`).value,
        title_fr: document.getElementById(`${modalId}-title-fr`).value,
        bio: document.getElementById(`${modalId}-bio`).value,
        bio_fr: document.getElementById(`${modalId}-bio-fr`).value,
        topics: document.getElementById(`${modalId}-topics`).value.split(',').map(t => t.trim()).filter(t => t),
        topics_fr: document.getElementById(`${modalId}-topics-fr`).value.split(',').map(t => t.trim()).filter(t => t),
        keyTopics: document.getElementById(`${modalId}-key-topics`).value.split(',').map(t => t.trim()).filter(t => t),
        keyTopics_fr: document.getElementById(`${modalId}-key-topics-fr`).value.split(',').map(t => t.trim()).filter(t => t),
        image: document.getElementById(`${modalId}-image`).value
      };

      try {
        if (updated.id) {
          // update existing
          const res = await fetch(`/api/speakers/${updated.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updated)
          });
          if (!res.ok) throw new Error('Failed to save speaker');
          const saved = await res.json();
          // find in array and replace
          const idx = speakersData.findIndex(x => x.id === saved.id);
          if (idx !== -1) speakersData[idx] = saved;
        } else {
          // create new (in case it's an unsaved local speaker)
          const res = await fetch('/api/speakers', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updated)
          });
          if (!res.ok) throw new Error('Failed to create speaker');
          const created = await res.json();
          // replace local placeholder or push
          if (speaker && speaker.tempLocal) {
            speakersData[index] = created;
          } else {
            speakersData.push(created);
          }
        }

        renderSpeakersList();
        document.getElementById(modalId).remove();
        showSuccess('Speaker saved!');
      } catch (err) {
        alert('Error saving speaker: ' + err.message);
      }
    });
  }

  // ======== Export/Backup ========
  function exportContent(){
    saveCurrentLanguageData(); // ensure contentData is current
    const payload = { content: contentData, speakers: speakersData };
    downloadObjectAsJson(payload, 'facettes-full-backup.json');
  }

  // ======== Filter speakers in UI search ========
  function filterSpeakers(){
    const q = document.getElementById('speakerSearch').value.trim().toLowerCase();
    document.querySelectorAll('#speakersList .speaker-item').forEach((el, i) => {
      const s = speakersData[i];
      if (!s) { el.style.display = 'none'; return; }
      const match = (s.name || '').toLowerCase().includes(q) ||
                    (s.title || '').toLowerCase().includes(q) ||
                    (s.topics || []).some(t => t.toLowerCase().includes(q));
      el.style.display = match ? 'block' : 'none';
    });
  }

  // ======== Language switching ========
  function switchLanguage(lang){
    saveCurrentLanguageData();
    currentLang = lang;
    document.getElementById('tab-en').className = lang === 'en'
      ? 'px-6 py-3 rounded-lg font-bold transition bg-purple-600 text-white shadow-lg'
      : 'px-6 py-3 rounded-lg font-bold transition bg-gray-300 text-gray-700 hover:bg-gray-400';
    document.getElementById('tab-fr').className = lang === 'fr'
      ? 'px-6 py-3 rounded-lg font-bold transition bg-purple-600 text-white shadow-lg'
      : 'px-6 py-3 rounded-lg font-bold transition bg-gray-300 text-gray-700 hover:bg-gray-400';
    populateFields();
  }

  // ======== Safe HTML escape for values injected into modal template ========
  function escapeHtml(str){
    if (!str && str !== 0) return '';
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // ======== Init ========
  document.addEventListener('DOMContentLoaded', loadContent);
  </script>

</body>
</html>
